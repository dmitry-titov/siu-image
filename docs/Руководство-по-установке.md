## Установка и настройка postgresql
* Устанавливаем postgresql из пакета: `sudo apt-get install postgresql-9.1`
* Настраиваем авторизацию и параметры:
`/etc/postgresql/9.1/main/postgresql.conf` устанавливаем `max_prepared_transaction` как `max_connections` (Например: `max_prepared_transaction=20`)
* проверяем, что включена авторизация и в `/etc/postgresql/9.1/main/pg_hba.conf` есть строка

> TYPE  DATABASE        USER            ADDRESS                 METHOD

>     host    all             all             127.0.0.1/32            md5


* После правок конфигурации,  применяем их:
`sudo service postgresql restart`
* Создаем пользователя и базы
Заходим администратором БД: `sudo su -l postgres -s /bin/bash`

Создаем пользователя: `createuser as -E -P 123456789`

Создаём базы данных:

    createdb gws -O as -E UTF8 --lc-collate=ru_RU.UTF-8 --lc-ctype=ru_RU.UTF-8
    createdb gses_tmp -O as -E UTF8 --lc-collate=ru_RU.UTF-8 --lc-ctype=ru_RU.UTF-8

Выходим из режима администратора БД: `exit`


## Установка Java
Внимание! Для сертифицированной версии Крипто-Про JCP нужна версия java 6. 

Пример для ubuntu для java 6:

    sudo add-apt-repository ppa:webupd8team/java
    sudo apt-get update
    sudo apt-get install oracle-java6-installer
    sudo update-java-alternatives -s java-6-oracle

Пример для ubuntu для java 7:

    sudo add-apt-repository ppa:webupd8team/java
    sudo apt-get update
    sudo apt-get install oracle-java7-installer
    sudo update-java-alternatives -s java-7-oracle

## Установка Крипто Про
* Скачиваем сертифицированную версию КриптоПРо JCP 1.0.52 / 1.0.53

> Если у Вас java 7, Вам необходима не сертифицированная версия JCP 2.0.37027, так как сертифицированные версии не совместимы с java 7!
> Регистрируемся на сайте cryptopro.ru, скачиваем [https://www.cryptopro.ru/sites/default/files/private/jcp/jcp-2.0.37027.zip](https://www.cryptopro.ru/sites/default/files/private/jcp/jcp-2.0.37027.zip)

* Распаковываем архив
* Идем в папку lib внутри папки, в которую распаковался архив
* Запускаем `install.sh`
формат команды запуска: [скрипт-нисталлятор] [путь до jre] [ключ] [владелец лицензии]

 * без лицензии на 3 месяца:
`sudo sh install.sh /usr/lib/jvm/java`

 * с лицензией:
`sudo sh install.sh /usr/lib/jvm/java AAAAA-BBBBB-CCCCC-DDDDD-EEEEE "Ваша компания"`

* Установка ключей
Для работы со СМЭВ необходима подпись системы.
Копируем папку ключа в `/var/CPROcsp/keys/${USER}`


# Устанавливаем сервер приложений Glassfish 
Скачиваем архив с официального сайта и распаковываем. По-умолчанию папка c сервером - glassfish3

    wget http://dlc.sun.com.edgesuite.net/glassfish/3.1.2.2/release/glassfish-3.1.2.2-ml.zip
    unzip glassfish-3.1.2.2-ml.zip

Устанавливаем JDBC драйвер в домене управления

    wget http://jdbc.postgresql.org/download/postgresql-9.1-902.jdbc4.jar
    cp postgresql-9.1-902.jdbc4.jar ~/glassfish3/glassfish/domains/domain1/lib/ext

Можно взять [этот файл](https://github.com/CodeInside/siu/blob/master/domain.xml) с конфигурацией домена и скопировать в 

`cp domain.xml ~/glassfish3/glassfish/domains/domain1/config/`

Запускаем сервер glassfish 

`~/glassfish3/glassfish/bin/asadmin start-domain`

После выполнения вышеописанных действий, серверное окружение готово к установке модулей СИУ. Сборку можно производить не на сервере, а, скажем на машине разработчика, и, после сборки исходных кодов, установить исполняемые модули СИУ на сервер.

## Сборка и установка СИУ

### Устанавливаем git:

`sudo apt-get install git`

Скачиваем с GitHub проект:

`git clone https://github.com/CodeInside/siu.git`

Устанавливаем maven в домашний каталог:

    wget http://apache-mirror.rbc.ru/pub/apache/maven/maven-3/3.1.1/binaries/apache-maven-3.1.1-bin.tar.gz
    tar xvf apache-maven-3.1.1-bin.tar.gz
    sudo ln -s ~/apache-maven-3.1.1/bin/mvn /usr/bin/mvn

Собираем и устанавливаем siu в glassfish:
   
    cd ~/siu 
    mvn install 
    cd uat-deployer
    mvn package
    cp target/bundles/*.jar ~/glassfish3/glassfish/domains/domain1/autodeploy/bundles`

Приложение доступно по адресу: `http://127.0.0.1:8086/web-client/ui`